---
title: "DF2-Education"
author: "Abhay Prasanna Rao"
date: "2023-12-02"
output: html_document
---

```{r setup_education, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

------------------------------------------------------------------------

## DF 2 - Education

```{r}
#Neha
#Education - K201501
df2 <- get_acs(geography = "state", 
                table = "K201501", 
                year = 2021, 
                survey = "acs1/subject",cache_table = TRUE)

variables_df2 <- data.frame(
  variable = c("K201501_001", "K201501_002", "K201501_003", "K201501_004", "K201501_005", "K201501_006", "K201501_007", "K201501_008"),
  label = c("Education_Total_students", "Education_Below_9th grade", "Education_9th to 12th grade_no diploma", "Education_High_school_graduate", "Education_Some college_no degree", "Education_Associates_degree", "Education_Bachelors_degree", "Education_Graduate_professional degree")
)

df2_labeled <- df2 %>%
  left_join(variables_df2, by = "variable")

df2_wide <- df2_labeled %>%
  pivot_wider(names_from = label, values_from = estimate, id_cols = NAME)
```
**Exploratory Data Analysis (EDA)**

```{r}
# Ensure necessary libraries are installed and loaded
if (!require("ggplot2")) install.packages("ggplot2")
if (!require("tidyr")) install.packages("tidyr")
library(ggplot2)
library(tidyr)

# Convert df2_wide to long format
df2_long <- df2_wide %>%
  gather(key = "Education_Level", value = "Count", -NAME)

# Plotting the distribution of each education level across states
ggplot(df2_long, aes(x = NAME, y = Count, fill = Education_Level)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(title = "Distribution of Education Levels across States", 
       x = "State", 
       y = "Count")

```
**Exploratory Data Analysis (EDA)** based on percentage

```{r}
library(ggplot2)
library(tidyr)
library(dplyr)

# Convert df2_wide to long format
df2_long <- df2_wide %>%
  gather(key = "Education_Level", value = "Count", -NAME)

# Calculate total count for each state
df2_long <- df2_long %>%
  group_by(NAME) %>%
  mutate(Total = sum(Count)) %>%
  ungroup()

# Calculate the percentage
df2_long <- df2_long %>%
  mutate(Percentage = (Count / Total) * 100)

# Plotting the distribution of each education level across states as a percentage
ggplot(df2_long, aes(x = NAME, y = Percentage, fill = Education_Level)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(title = "Percentage Distribution of Education Levels across States", 
       x = "State", 
       y = "Percentage")

```
```{r}
library(ggplot2)
library(tidyr)
library(dplyr)

# Convert df2_wide to long format
df2_long <- df2_wide %>%
  gather(key = "Education_Level", value = "Count", -NAME)

# Calculate total count for each state only once
total_counts <- df2_long %>%
  group_by(NAME) %>%
  summarize(Total = sum(Count)) 

# Join with original data to add the Total column
df2_long <- df2_long %>%
  left_join(total_counts, by = "NAME")

# Calculate the percentage for each education level
df2_long <- df2_long %>%
  mutate(Percentage = (Count / Total) * 100)

# Create graphs for each educational level
unique_levels <- unique(df2_long$Education_Level)
plots <- list()

for (level in unique_levels) {
  df_subset <- filter(df2_long, Education_Level == level)

  p <- ggplot(df_subset, aes(x = NAME, y = Percentage, fill = Education_Level)) +
    geom_bar(stat = "identity") +
    theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
    labs(title = paste("Percentage Distribution of", level, "across States"), 
         x = "State", 
         y = "Percentage") +
    guides(fill = guide_legend(title = "Education Level"))

  plots[[level]] <- p
}

# Print plots (optional)
for (plot in plots) {
  print(plot)
}

```

```{r}
df2_percentages <- df2_wide %>%
  mutate(
    `Education_Below_9th grade_Percentage` = `Education_Below_9th grade` / Education_Total_students * 100,
    `Education_9th to 12th grade_no diploma_Percentage` = `Education_9th to 12th grade_no diploma` / Education_Total_students * 100,
    Education_High_school_graduate_Percentage = Education_High_school_graduate / Education_Total_students * 100,
    `Education_Some college_no degree_Percentage` = `Education_Some college_no degree` / Education_Total_students * 100,
    Education_Associates_degree_Percentage = Education_Associates_degree / Education_Total_students * 100,
    Education_Bachelors_degree_Percentage = Education_Bachelors_degree / Education_Total_students * 100,
    `Education_Graduate_professional degree_Percentage` = `Education_Graduate_professional degree` / Education_Total_students * 100
  )
percentage_columns <- grep("_Percentage$", names(df2_percentages), value = TRUE)
df2_long <- df2_percentages %>%
  pivot_longer(cols = percentage_columns, names_to = "Age_Group", values_to = "Percentage")
ggplot(df2_long, aes(x = reorder(NAME, -Education_Total_students), y = Percentage, fill = Age_Group)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Age Distribution by State",
       x = "State",
       y = "Percentage of Total Population",
       fill = "Age Group") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) 
 
```
```{r}
ggplot(df2_percentages, aes(x = reorder(NAME,`Education_Graduate_professional degree_Percentage`, mean), y = `Education_Graduate_professional degree_Percentage`)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
  labs(title = "Education Distribution by State",
       x = "State",
       y = "Percentage of people with graduate level degree)")

```
```{r}
ggplot(df2_percentages, aes(x = reorder(NAME,Education_High_school_graduate_percentage, mean), y = Education_High_school_graduate_percentage)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
  labs(title = "Education Distribution by State",
       x = "State",
       y = "Percentage of people with graduate level degree)")


```



------------------------------------------------------------------------