---
title: "Proposal Draft 1"
authors: ["Abhay", "Srika","Neha","Esha","Niharika"]
date: "2023-11-12"
output: html_document
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### \*\*Project Title: Income and employment for the various county's in USA\*

```{r}
#census_api_key(Sys.getenv("CENSUS_API_KEY"), install = TRUE)
```

```{r}
#install.packages("tidycensus")
# Load necessary libraries
library(tidycensus)
library(dplyr)
library(tidyr)
```


```{r}

```

```{r}
#Abhay
#Employment - K202301 for 2021


# Set your Census API key
# census_api_key("your_key_here") # Uncomment and put your API key here



# Get ACS data
df1 <- get_acs(geography = "state", 
               table = "K202301", 
               year = 2021, 
               survey = "acs1-year", 
               cache_table = TRUE)

variables_df1 <- data.frame(
  variable = c("K202301_001", "K202301_002", "K202301_003", "K202301_004", "K202301_005", "K202301_006", "K202301_007"),
  label = c("Total", "Total In labor force:", 
            "Total Civilian labor force:", "Employed", 
            "Unemployed", "Armed Forces", "Not in labor force")
)
# Join with variable labels


# Now df_labeled will have an additional column with the variable labels
# Load variables for ACS 2022
# Sample mapping of variable codes to labels
# Replace this with the actual codes and labels


# Assuming df1 is your data frame with the estimates you've loaded
# Make sure to replace 'NAME' and 'estimate' with the actual column names from your df1

# Join your data with the variable labels to get the descriptive names
df1_labeled <- df1 %>%
  left_join(variables_df1, by = "variable")

# Reshape the data so that state names are rows and variable labels are columns
df1_wide <- df1_labeled %>%
  pivot_wider(names_from = label, values_from = estimate, id_cols = NAME)


# df_wide now has states as columns and the descriptive variable labels as rows


```

```{r}
#Neha
#Education - K201501
df2 <- get_acs(geography = "state", 
                table = "K201501", 
                year = 2021, 
                survey = "acs1/subject",cache_table = TRUE)
```

```{r}
#Esha
#Citizenship - K200501
#df3 <-

```

```{r}
#Srika
#Age - K200104
df4 <- get_acs(geography = "state", 
                table = "K200104", 
                year = 2021, 
                survey = "acs1/subject",cache_table = TRUE)
```

```{r}
#Niharika
# Housing - K202502
df5 <- get_acs(geography = "state", 
                table = "K202502", 
                year = 2021, 
                survey = "acs1", # removed /subject since we're referring to a specific table ID
                cache_table = TRUE)
```






### [**Project Idea Update:**]{.underline}

#### [Description of the Data Set 1:]{.underline}

-   **Source**: 2022 American Community Survey (ACS) 1-Year Estimates.

-   **Focus**: Total population by sex in different geographic areas.

-   **Variables**: Population estimates by sex, geographic identifiers, and margin of error.

#### Adjusted Data Cleaning Steps:

1.  Inspecting the data

    ```{r}
    head(df1)

    ```

2.  **Handle Missing Values**
    ```{r}
    df1 <- na.omit(df1)  # This removes rows with NA values
    ```

3.  Address Special Symbols
```{r}
df1[df1 == '-'] <- NA
df1[df1 == 'N'] <- NA
df1[df1 == '(X)'] <- NA
```

4. Standardize GEOID and Variable Names
```{r}
df1$GEOID <- as.factor(df1$GEOID)
df1$variable <- as.factor(df1$variable)
```



####  

#### Updated Marginal Summaries:
```{r}
summary(df1)
```


-   **Population Breakdown**: Summarize population counts by sex across different regions.
```{r}
library(dplyr)
population_breakdown <- df1 %>%
  group_by(NAME, variable) %>%
  summarize(Total_Population = sum(estimate, na.rm = TRUE))

population_breakdown

```


-   **Error Analysis**: Evaluate the impact of margin of error on population estimates.
```{r}

error_analysis <- df1 %>%
  filter(!is.na(moe)) %>%  # Filter out rows where moe is NA
  mutate(Percent_MOE = (moe / estimate) * 100) %>%  # Calculate percent MOE
  summarize(Average_MOE = mean(Percent_MOE, na.rm = TRUE))  # Average MOE

error_analysis

```

Further, we are going to take different variables(employment and income) and then combine them by the same counties. 
