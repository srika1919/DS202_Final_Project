---
title: "DF5-Housing"
author: "Abhay Prasanna Rao"
date: "2023-12-02"
output: html_document
---

```{r setup_housing, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



------------------------------------------------------------------------

## DF5 - Housing

```{r}
#Niharika
# Housing - K202502
df5 <- get_acs(geography = "state", 
                table = "K202502", 
                year = 2021, 
                survey = "acs1", # removed /subject since we're referring to a specific table ID
                cache_table = TRUE)

# Define the variable codes and their respective labels for the housing dataset (df5)
variables_df5 <- data.frame(
  variable = c("K202502_001", "K202502_002", "K202502_003"),
  label = c("Total", "Owner Occupied", "Renter Occupied")
)

# Assuming df5 is your housing dataset
# Reshape the data so that state names are rows
df5_labeled <- df5 %>%
  left_join(variables_df5, by = "variable")  # Joining with the variable labels dataframe

# Reshape the data to have state names as rows and variable labels as columns
df5_wide <- df5_labeled %>%
  pivot_wider(names_from = label, values_from = estimate, id_cols = NAME)

# df5_wide will have states as rows and different housing-related variables as columns


```

```{r}
library(dplyr)
library(tidyr)
library(ggplot2)
library(scales)

# Assuming df5_wide is your dataset for housing
# Melt the data to long format for easy plotting
df5_long <- tidyr::gather(df5_wide, key = "Housing_Category", value = "Count", -NAME)

# Calculate the percentage for Owner and Renter Occupied categories
df5_long <- df5_long %>%
  group_by(NAME) %>%
  mutate(Total = sum(Count[which(Housing_Category == "Total")])) %>%
  ungroup() %>%
  mutate(Percentage = ifelse(Housing_Category != "Total", Count / Total * 100, Count))

# Define colors for each category
category_colors <- c("Owner Occupied" = "steelblue", "Renter Occupied" = "salmon", "Total" = "lightgreen")

# Function to create a bar plot
create_bar_plot <- function(data, category, title) {
  ggplot(data[data$Housing_Category == category, ], aes(x = reorder(NAME, -Percentage), y = Percentage, fill = Housing_Category)) +
    geom_bar(stat = "identity", position = position_dodge()) +
    labs(x = "State", y = "Percentage", title = title) +
    scale_y_continuous(labels = percent_format(scale = 1)) +
    scale_fill_manual(values = category_colors) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
}

# Plot for Owner Occupied
owner_plot <- create_bar_plot(df5_long, "Owner Occupied", "Percentage of Owner Occupied Housing by State")
print(owner_plot)

# Plot for Renter Occupied
renter_plot <- create_bar_plot(df5_long, "Renter Occupied", "Percentage of Renter Occupied Housing by State")
print(renter_plot)




```

